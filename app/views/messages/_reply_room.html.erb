<div class="message-replies flex flex-col w-1/3 overflow-hidden border-l " data-controller="replies"  data-replies-id="<%= message.id %>">

  <div class="space-target-title border-b items-center flex-none bg-gray">

    <div class="flex justify-between items-center">
      <div class="flex flex-col">
        <h3 class="title-emphasize mb-1 font-extrabold">
          <span>對話串 #</span>
          <span>
            <% if channel.direct_message %>
            <%= receiver.display_name %>
            <% else %>
            <%= channel.name %>
            <% end %>
          </span>
        </h3>
      </div>
      <div class="replies-closed">
        <button class="replies-closed-btn" data-action="replies#closeReplyRoom">X</button>
      </div>
    </div>
  </div>

  <div class="reply-box flex-1 overflow-y-scroll px-6 pt-4" data-replies-target="replyBox">
    <div class="flex items-start mb-2 text-sm">
      <div class='w-10 h-10 rounded mr-3'>
        <%= image_tag message.user.avatar_url , class: 'sp-user-avatar'%>
      </div>
      <div class="flex-1 overflow-hidden relative">
        <div>
          <span class="font-bold">
            <%= message.user.display_name %>
          </span>
          <span class="text-grey text-xs">
            <%= message.created_at.strftime("%b %d %R") %>
          </span>
        </div>
        <p class="text-black leading-normal">
          <%= message.content %>
        </p>
      </div>
      <p class="text-black leading-normal">
        <%= message.content %>
      </p>
    </div>
  </div>
  <div class="reply-count mb-2 <%= message.replies.present? ? "visible" : "invisible" %>" data-replies-target="replyCount">有<span data-replies-target="replyNum"><%= message.replies.count %></span>則回覆</div>
  <% message.replies.each do |reply| %>
  <%= render "replies/reply" , reply: reply %>
  <% end %>
</div>

<div class="flex-none">
  <div class="message-editor-panel py-4 px-4 flex-none">
    <div class="message-editor flex rounded-lg border-2 border-grey overflow-hidden">
      <%= form_with model: Reply.new, url: message_replies_path(message), class: "flex w-full flex flex-col" , data: {
        action: "replies#sendReply" }, html: { autocomplete: "off" } do |form| %>
        <div class="relative flex flex-col">
          <%= form.rich_text_area :content, class: "relative w-full px-4", data: { "replies-target": "input"}, placeholder: "Reply..." %>
          <span class="msg-txtarea-submit flex relative">
            <%= image_submit_tag 'cursor-fill.svg' %>
          </span>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
